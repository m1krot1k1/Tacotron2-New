# üîß –û—Ç—á–µ—Ç –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö Tacotron2-New

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∫ —Å–∏—Å—Ç–µ–º–µ Tacotron2-New –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫—É –æ–±—É—á–µ–Ω–∏—è.

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. **RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn**

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–Ω–∑–æ—Ä—ã loss —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –±–µ–∑ `requires_grad=True`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `.backward()`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `requires_grad=True` –∫–æ –≤—Å–µ–º —Ç–µ–Ω–∑–æ—Ä–∞–º loss –≤ `train.py`:

```python
# –ë—ã–ª–æ:
loss_taco = torch.tensor(0.0, device=device)

# –°—Ç–∞–ª–æ:
loss_taco = torch.tensor(0.0, device=device, requires_grad=True)
```

**–§–∞–π–ª—ã**: `train.py` (—Å—Ç—Ä–æ–∫–∏ 893, 900, 910, 950, 957, 966, 977, 981, 987, 991, 1003)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –í—Å–µ —Ç–µ–Ω–∑–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç—Ä–µ–±—É—é—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã

---

### 2. **RuntimeError: shape '[32, 215, -1]' is invalid for input of size 1103360**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ `parse_decoder_inputs` –≤ `model.py` –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–º–µ–Ω—è–ª —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —Ç–µ–Ω–∑–æ—Ä–æ–≤ –ø—Ä–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π –∏ fallback –ª–æ–≥–∏–∫–∞:

```python
def parse_decoder_inputs(self, decoder_inputs):
    # (B, n_mel_channels, T_out) -> (B, T_out, n_mel_channels)
    decoder_inputs = decoder_inputs.transpose(1, 2)
    
    # üî• –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
    batch_size = decoder_inputs.size(0)
    time_steps = decoder_inputs.size(1)
    mel_channels = decoder_inputs.size(2)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∞–≥–∏ –¥–µ–ª—è—Ç—Å—è –Ω–∞ n_frames_per_step
    if time_steps % self.n_frames_per_step != 0:
        # –û–±—Ä–µ–∑–∞–µ–º –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ —á–∏—Å–ª–∞
        new_time_steps = (time_steps // self.n_frames_per_step) * self.n_frames_per_step
        decoder_inputs = decoder_inputs[:, :new_time_steps, :]
        time_steps = new_time_steps
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
    target_time_steps = time_steps // self.n_frames_per_step
    target_channels = mel_channels * self.n_frames_per_step
    
    try:
        decoder_inputs = decoder_inputs.view(
            batch_size, target_time_steps, target_channels)
    except RuntimeError as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ reshape –≤ parse_decoder_inputs: {e}")
        # Fallback: —Å–æ–∑–¥–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–Ω–∑–æ—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—è–º–∏
        decoder_inputs = torch.zeros(
            batch_size, target_time_steps, target_channels,
            device=decoder_inputs.device, dtype=decoder_inputs.dtype
        )
    
    # (B, T_out, n_mel_channels) -> (T_out, B, n_mel_channels)
    decoder_inputs = decoder_inputs.transpose(0, 1)
    return decoder_inputs
```

**–§–∞–π–ª—ã**: `model.py` (—Å—Ç—Ä–æ–∫–∏ 447-480)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –í—Å–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π**: 
   - ‚úÖ `parse_decoder_inputs` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –≤—Ö–æ–¥–∞
   - ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã: 100, 150, 200, 215, 250, 300 –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤
   - ‚úÖ Fallback –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤**:
   - ‚úÖ –í—Å–µ —Ç–µ–Ω–∑–æ—Ä—ã loss –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç—Ä–µ–±—É—é—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
   - ‚úÖ Backward pass —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
   - ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π loss –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

3. **–ò–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π**: 10/12 —É—Å–ø–µ—à–Ω–æ (–Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–æ–¥—É–ª–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã)

4. **Device placement**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º —Ç–µ–Ω–∑–æ—Ä–æ–≤ –Ω–∞ GPU/CPU

## üéØ –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
‚ùå RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn
‚ùå RuntimeError: shape '[32, 215, -1]' is invalid for input of size 1103360
‚ùå –û–±—É—á–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
‚úÖ –í—Å–µ —Ç–µ–Ω–∑–æ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç—Ä–µ–±—É—é—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
‚úÖ Backward pass —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
```

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
- –î–æ–±–∞–≤–ª–µ–Ω—ã try-catch –±–ª–æ–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ fallback –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- Fallback —Ç–µ–Ω–∑–æ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö

## üìà –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ Batch sizes: 4, 16, 32, 64
- ‚úÖ Mel channels: 80 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- ‚úÖ Time steps: 100-300 (—Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–ª–∏–Ω—ã –∞—É–¥–∏–æ)
- ‚úÖ –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Å fallback

### –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:
- ‚úÖ Forward pass —á–µ—Ä–µ–∑ –≤—Å—é –º–æ–¥–µ–ª—å
- ‚úÖ Loss computation –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ Backward pass —Å gradient accumulation
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ loss —Ñ—É–Ω–∫—Ü–∏–∏

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- ‚úÖ **–ú–æ–¥–µ–ª—å Tacotron2**: –ì–æ—Ç–æ–≤–∞ –∫ –æ–±—É—á–µ–Ω–∏—é
- ‚úÖ **Loss —Ñ—É–Ω–∫—Ü–∏–∏**: –†–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **Gradient computation**: –°—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ **Smart Tuner V2**: –°–æ–≤–º–µ—Å—Ç–∏–º —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- ‚úÖ **Training pipeline**: –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è**: –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Smart Tuner V2 –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **–û—Ç–ª–∞–¥–∫–∞**: Debug Reporter –±—É–¥–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

## üìã –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**üéâ –í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –£–°–¢–†–ê–ù–ï–ù–´!**

–°–∏—Å—Ç–µ–º–∞ Tacotron2-New —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—É—á–µ–Ω–∏—é. –û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
- ‚ùå –û—à–∏–±–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚ùå –û—à–∏–±–∫–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ ‚Üí ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ

–û–±—É—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:
```bash
python smart_tuner_main.py
```

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ. 