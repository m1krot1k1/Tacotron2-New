# üöÄ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SMART TUNER V2
# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è

# üß† Adaptive Advisor - –ë–æ–ª–µ–µ —É–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
adaptive_advisor:
  enabled: true
  evaluation_window: 50  # –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏
  min_history_for_decision: 100  # –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö —Ä–µ—à–µ–Ω–∏–π
  min_reward_threshold: -0.05  # –°–º—è–≥—á–µ–Ω–æ –¥–ª—è –ª—É—á—à–µ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏
  
  # –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
  diagnostics:
    instability:
      grad_norm_threshold: 100.0  # –°–Ω–∏–∂–µ–Ω–æ —Å 200 –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
    overfitting:
      threshold: 3.0  # –°–Ω–∏–∂–µ–Ω–æ —Å 5.0 –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è
      window_size: 30  # –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏
    stagnation:
      min_delta: 0.001  # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.0005 –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
      window_size: 100  # –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏
    attention_failure:
      min_alignment_score: 0.5  # –°–Ω–∏–∂–µ–Ω–æ —Å 0.7 –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
      alignment_window: 50  # –£–º–µ–Ω—å—à–µ–Ω–æ
    gate_collapse:
      min_gate_accuracy: 0.6  # –°–Ω–∏–∂–µ–Ω–æ —Å 0.8 –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
      gate_window: 30  # –£–º–µ–Ω—å—à–µ–Ω–æ

  # –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
  default_actions:
    instability:
      name: stability_boost
      params:
        learning_rate_multiplier: 0.8  # –ë–æ–ª–µ–µ –º—è–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ
        gradient_clipping: 5.0
        batch_size_adjust: 0.8
    overfitting:
      name: regularization_boost
      params:
        dropout_increase: 0.05  # –ú—è–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
        weight_decay_increase: 0.1
    stagnation:
      name: learning_boost
      params:
        learning_rate_multiplier: 1.2  # –£–º–µ—Ä–µ–Ω–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ
        warmup_steps_adjust: 1.1
    attention_failure:
      name: attention_recovery
      params:
        guided_attention_boost: 1.5
        attention_dropout_reduction: 0.05
    gate_collapse:
      name: gate_recovery
      params:
        gate_loss_weight: 1.3
        gate_threshold_adjust: -0.05

# üìä –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –∫–∞—á–µ—Å—Ç–≤–∞ TTS
training_safety:
  enabled: true
  max_training_hours: 24.0  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 48
  min_training_hours: 2.0   # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 8 (–±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ)
  max_validation_loss: 30.0  # –°–Ω–∏–∂–µ–Ω–æ —Å 50.0
  min_training_steps: 5000   # –°–Ω–∏–∂–µ–Ω–æ —Å 20000 –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  
  # üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ TTS
  tts_quality_checks:
    # –ë–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
    min_attention_alignment: 0.6      # –ü–æ–≤—ã—à–µ–Ω–æ —Å 0.4 –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
    min_gate_accuracy: 0.7           # –ü–æ–≤—ã—à–µ–Ω–æ —Å 0.5 
    max_validation_loss: 15.0        # –ü–æ–Ω–∏–∂–µ–Ω–æ —Å 25.0 –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
    mel_quality_threshold: 0.4       # –ü–æ–≤—ã—à–µ–Ω–æ —Å 0.3
    min_training_progress: 0.08      # –ü–æ–≤—ã—à–µ–Ω–æ —Å 0.05 –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    min_validation_steps: 5          # –ú–∏–Ω–∏–º—É–º validation —à–∞–≥–æ–≤
    min_training_time_minutes: 15    # –ú–∏–Ω–∏–º—É–º –≤—Ä–µ–º–µ–Ω–∏ –æ–±—É—á–µ–Ω–∏—è
    required_checks_percentage: 0.9  # 90% –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏
    
    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏)
    critical_checks:
      - attention_alignment
      - gate_accuracy  
      - validation_loss

# üîß –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã 
hyperparameter_search_space:
  batch_size:
    type: int
    min: 8
    max: 64
    default: 32
    
  epochs:
    type: int
    min: 500          # –ú–∏–Ω–∏–º—É–º –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
    max: 5000         # –ú–∞–∫—Å–∏–º—É–º –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è  
    default: 2000     # –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
    
  learning_rate:
    type: float
    min: 0.000001     # 1e-6
    max: 0.001        # 1e-3
    default: 0.0001   # 1e-4 - –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    log: true         # –õ–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∞—è —à–∫–∞–ª–∞ –¥–ª—è learning rate
    
  warmup_steps:
    type: int
    min: 500     # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1000
    max: 3000    # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5000
    default: 1500
    
  guided_attention_enabled:
    type: categorical
    choices: [true, false]
    default: true
    
  guide_loss_weight:
    type: float
    min: 0.5
    max: 3.0     # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5.0
    default: 1.5 # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.0
    
  p_attention_dropout:
    type: float
    min: 0.0
    max: 0.2     # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.3
    default: 0.1
    
  gate_threshold:
    type: float
    min: 0.3
    max: 0.7
    default: 0.5
    
  dropout_rate:
    type: float
    min: 0.1
    max: 0.4     # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: —É–º–µ–Ω—å—à–µ–Ω–æ —Å 0.7
    default: 0.2 # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.3
    
  postnet_dropout_rate:
    type: float
    min: 0.0
    max: 0.2     # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.3
    default: 0.1

# üéØ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
optimization:
  direction: minimize
  n_trials: 20  # –†–∞–∑—É–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  objective_metric: composite_tts_score
  continue_training: true
  
  # –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ trial
  full_epochs_per_trial: 80  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 100 –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
  overfitting_penalty: 0.03  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.05
  
  # –ë–æ–ª–µ–µ —â–∞–¥—è—â–∏–µ TTS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  tts_specific:
    min_training_steps: 3000         # –°–Ω–∏–∂–µ–Ω–æ —Å 20000
    attention_convergence_threshold: 0.6  # –°–Ω–∏–∂–µ–Ω–æ —Å 0.8
    gate_accuracy_threshold: 0.65    # –°–Ω–∏–∂–µ–Ω–æ —Å 0.85
    early_pruning_disabled_epochs: 50 # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 100
    
  # –ë–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
  composite_objective:
    weights:
      validation_loss: 0.5           # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.4
      attention_alignment_score: 0.2 # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.3
      gate_accuracy: 0.2            # –¢–æ –∂–µ
      mel_quality_score: 0.1        # –¢–æ –∂–µ
    normalize_scores: true
    quality_bonus_threshold: 0.8     # –ë–æ–Ω—É—Å –∑–∞ —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
    progress_weight: 0.1             # –í–µ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è

# üõë –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–Ω–µ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)
early_stopping:
  enabled: true
  
  # –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞
  patience_epochs: 200        # –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è TTS
  min_delta: 0.001           # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
  monitor_metric: "val_loss"
  
  # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∑—ã –æ–±—É—á–µ–Ω–∏—è
  adaptive_thresholds:
    enabled: true
    
    # –§–∞–∑–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è attention (0-500 —ç–ø–æ—Ö)
    alignment_phase:
      patience: 100
      min_improvement: 0.01
      attention_threshold: 0.5
      
    # –§–∞–∑–∞ –æ–±—É—á–µ–Ω–∏—è (500-2000 —ç–ø–æ—Ö)  
    learning_phase:
      patience: 150
      min_improvement: 0.005
      attention_threshold: 0.8
      
    # –§–∞–∑–∞ —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (2000+ —ç–ø–æ—Ö)
    fine_tuning_phase:
      patience: 200
      min_improvement: 0.001
      attention_threshold: 0.9

# üìà TTS –º–µ—Ç—Ä–∏–∫–∏ —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏
tts_metrics:
  attention_metrics:
    alignment_score_weight: 1.0
    attention_entropy_weight: 0.3  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.5
    attention_sharpness_weight: 0.2 # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.3
  gate_metrics:
    accuracy_weight: 1.0
    precision_weight: 0.6  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.8
    recall_weight: 0.6     # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.8
  mel_metrics:
    spectral_distance_weight: 1.0
    mel_cepstral_distortion_weight: 0.5  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.7

# üéì –§–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ TTS
tts_phase_training:
  enabled: true
  phases:
    pre_alignment:
      max_epochs: 500
    alignment_learning:
      max_epochs: 1500
    fine_tuning:
      max_epochs: 3000

# üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
experiment_name: tacotron2_smart_v2
output_dir: output
checkpoint_path: data/checkpoint
dataset_path: data/dataset
hparams_path: hparams.py

# üîå –ü–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
ports:
  mlflow: 5000
  tensorboard: 5001
  optimization_engine: 5002
  streamlit: 5003
  log_watcher: 5005
  metrics_store: 5006
  param_scheduler: 5007
  early_stop_controller: 5008
  alert_manager: 5009
  model_registry: 5010

# üìä MLflow –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
mlflow:
  tracking_uri: mlruns
  experiment_name: tacotron2_smart_optimization

# üèÜ –†–µ–µ—Å—Ç—Ä –º–æ–¥–µ–ª–µ–π
model_registry:
  path: smart_tuner/models
  best_model_name: best_tts_model.pt
  max_models: 3  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5
  primary_metric: val_loss
  minimize_metric: true

# üîÑ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
parameter_scheduling:
  learning_rate:
    enabled: true
    strategy: cosine
    start_value: 0.001
    end_value: 0.0001
    total_steps: 8000  # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10000

parameter_scheduling_config:
  update_frequency: 20  # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 10

# üéØ –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
final_training:
  epochs: 200

# üìù –û–±—É—á–µ–Ω–∏–µ
training:
  base_command: python train.py
  python_executable: python
  script_path: train.py
  continue_from_checkpoint: true
  full_training: true

# üîê –†–µ—Å—É—Ä—Å—ã
resources:
  checkpointing:
    path: output

# üì± Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
telegram:
  enabled: true
  bot_token: 2010534305:AAHqgXYT5RPcLoJe-wNdFaFbIJvJsN2xUHA
  chat_id: '536955174'
  parse_mode: Markdown
  disable_web_page_preview: true
  notifications:
    training_start: true
    training_complete: true
    optimization_updates: true
    error_alerts: true
    early_stop: true
    metrics_summary: true 