# TTS-Tech-Spec (v1.0)

> –î–æ–∫—É–º–µ–Ω—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ ¬´Intelligent TTS Training Pipeline¬ª –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –ø–æ–¥—Å–∏—Å—Ç–µ–º—É `Smart Tuner V2`. –û–Ω —Å–ª—É–∂–∏—Ç –µ–¥–∏–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã (SSoT) –¥–ª—è –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã.

---

## 1. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
* **–ú–æ–¥–µ–ª—å**: Tacotron2 (+ –≤–æ–∑–º–æ–∂–Ω—ã–µ FastSpeech2/VITS –≤ –±—É–¥—É—â–µ–º)
* **–¶–µ–ª—å**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è TTS —Å —É–º–Ω—ã–º –∞–≤—Ç–æ—Ç—é–Ω–∏–Ω–≥–æ–º –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —Å—Ç—Ä–æ–≥–∏–º MLOps-–∫–æ–Ω—Ç—É—Ä–æ–º.
* **–Ø–∑—ã–∫ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã**: Python ‚â• 3.11, PEP 8, PyTorch ‚â• 2.0.
* **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π –¥–∞–Ω–Ω—ã—Ö/–º–æ–¥–µ–ª–µ–π**: MLflow + (–ø–æ–∑–∂–µ DVC).
* **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: TensorBoard + (–æ–ø—Ü–∏—è W&B).
* **CI/CD**: GitHub Actions + flake8 + pytest.

---

## 2. –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Pull Request.
2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî **–Ω–∞ —Ä—É—Å—Å–∫–æ–º**.
3. –õ—é–±–æ–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä—ã (`flake8`, `black`) –∏ —Ç–µ—Å—Ç—ã.
4. –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è, –æ–±—É—á–µ–Ω–∏–µ, –∏–Ω—Ñ–µ—Ä–µ–Ω—Å) –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∏–∑ `install.sh`.

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∫—Ä–∞—Ç–∫–æ)
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|-----------|
| `data/` | –ê—É–¥–∏–æ, –º–µ—Ç–∫–∏, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—ã–±–æ—Ä–∫–∏ |
| `output/` | –ß–µ–∫–ø–æ–∏–Ω—Ç—ã, –ª–æ–≥–∏ MLflow/TensorBoard |
| `hifigan/` | –í–æ–∫–æ–¥–µ—Ä |
| `smart_tuner/` | (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ) –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ Smart Tuner V2 |

---

## 4. –ü–∞–π–ø–ª–∞–π–Ω –¥–∞–Ω–Ω—ã—Ö
1. –°—ã—Ä—ã–µ WAV ‚Üí `smart_segmenter.py` ‚Üí —Å–µ–≥–º–µ–Ω—Ç—ã.
2. –°–µ–≥–º–µ–Ω—Ç—ã ‚Üí `transcribe.py` ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.
3. –°–±–æ—Ä `.csv` –¥–ª—è `TextMelLoader`.
4. –•—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –¥–∞—Ç–∞—Å–µ—Ç–∞ —á–µ—Ä–µ–∑ MLflow Artifact-Store (–ø–æ–∑–∂–µ DVC).

---

## 5. –ü–∞–π–ø–ª–∞–π–Ω –æ–±—É—á–µ–Ω–∏—è
1. –ó–∞–ø—É—Å–∫ `train.py` –∏–∑ `install.sh` (—à–∞–≥ 3).
2. –ß–µ–∫–ø–æ–∏–Ω—Ç –∫–∞–∂–¥—ã–µ `iters_per_checkpoint` –∏—Ç–µ—Ä–∞—Ü–∏–π.
3. –õ–æ–≥–∏:
   * TensorBoard (`output/<run>/tb/`)
   * MLflow (`mlruns/`)
4. Early Stopping (baseline) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `train.py`.

---

## 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
* **MLflow** ‚Äî —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã, –º–µ—Ç—Ä–∏–∫–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, –º–æ–¥–µ–ª–∏.
* **TensorBoard** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ–∫-/–∞—É–¥–∏–æ-–º–µ—Ç—Ä–∏–∫.
* **Prometheus + Grafana** *(backlog)* ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ GPU/CPU.

---

## 7. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –º–æ–¥–µ–ª–∏
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Tacotron2 + MMI, GST.
* TODO: –¥–æ–±–∞–≤–∏—Ç—å FastSpeech2, VITS –∫–∞–∫ –ø–ª–∞–≥–∏–Ω—ã (`model_zoo/`).

---

## 8. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–¥–∞
* PEP 8.
* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ `pyproject.toml`: black + isort.
* 95 % —Å—Ç—Ä–æ–∫ –ø–æ–¥ —Ç–µ—Å—Ç–∞–º–∏ critical path (`pytest -q`).

---

## 9. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ MLflow.
* –•—Ä–∞–Ω–µ–Ω–∏–µ secret-token-–æ–≤ —á–µ—Ä–µ–∑ GitHub Secrets.
* –†–æ–ª–∏ –¥–æ—Å—Ç—É–ø–∞ (RBAC) –¥–ª—è MLflow, Grafana.

---

## 10. –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ ¬´Smart Tuner V2¬ª

### 10.1 –¶–µ–ª—å
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ª—É—á—à–∞—Ç—å –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑ —Å–±—Ä–æ—Å–∞ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è—è –∏—Å—Ç–æ—Ä–∏—é –ª–æ–≥–æ–≤, –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º –∫–∞—á–µ—Å—Ç–≤–∞.

### 10.2 –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª/–ú–æ–¥—É–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------|----------|
| **LogWatcher** | `smart_tuner/log_watcher.py` | –°–æ–±—ã—Ç–∏–π–Ω—ã–π –ø–∞—Ä—Å–µ—Ä MLflow/TensorBoard. |
| **MetricsStore** | `smart_tuner/metrics_store.py` | Redis/SQLite-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç—Ä–∏–∫. |
| **OptimizationEngine** | `smart_tuner/opt_engine.py` | Optuna + HyperBand + CMA-ES. |
| **ParamScheduler** | `smart_tuner/param_scheduler.py` | –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫–∏ `--hparams`. |
| **TrainerWrapper** | `smart_tuner/trainer_wrapper.py` | CLI-–æ–±–µ—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ `train.py`. |
| **EarlyStopController** | `smart_tuner/early_stop.py` | –ì–ª–æ–±–∞–ª—å–Ω—ã–π Early Stopping. |
| **AlertManager** | `smart_tuner/alert_manager.py` | Slack/Email –∞–ª–µ—Ä—Ç—ã. |

### 10.3 –î–∏–∞–≥—Ä–∞–º–º–∞
```mermaid
flowchart TD
    subgraph TuningLoop
        LW(LogWatcher) --> MS(MetricsStore)
        MS --> OE(OptimizationEngine)
        OE --> PS(ParamScheduler)
        PS --> TW(TrainerWrapper)
        TW -->|logs| MS
    end
    OE --> ESC(EarlyStopController)
```

### 10.4 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `smart_tuner.yaml`
```yaml
search_algorithm: optuna
n_trials: 50
resume_from_checkpoint: true
search_space:
  learning_rate: {type: loguniform, low: 1e-5, high: 1e-3}
  weight_decay:  {type: loguniform, low: 1e-6, high: 1e-3}
  dropout_decoder: {type: uniform, low: 0.0, high: 0.5}
```

### 10.5 –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã
1. **–°—Ç–∞—Ä—Ç**: `smart_tuner.py --config smart_tuner.yaml`.
2. **LogWatcher** –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ MLflow run `<parent>`.
3. –ü–æ—Å–ª–µ `n_startup_iters` –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏.
4. **OptimizationEngine** –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–æ–≤—ã–π –Ω–∞–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
5. **TrainerWrapper**:
   * –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π `train.py` (SIGINT),
   * –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ —Å `--checkpoint_path last.ckpt --hparams <–Ω–æ–≤—ã–µ>`.
6. –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –ø–æ–∫–∞ **EarlyStopController** –Ω–µ —Ä–µ—à–∏—Ç ¬´—Å—Ç–æ–ø¬ª.

### 10.6 –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
* `val_loss` –Ω–µ —É–ª—É—á—à–∏–ª—Å—è > `min_delta` –≤ `patience` –ø–æ–¥—Ä—è–¥ —Ç—é–Ω–∏–Ω–≥-–∏—Ç–µ—Ä–∞—Ü–∏–π.
* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `learning_rate` –¥–æ—Å—Ç–∏–≥ `1e-6`.
* `max_runtime_hours`.

### 10.7 –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
* `best_model.ckpt` –≤ MLflow.
* `tuning_history.json` (–≤–µ—Å—å –ø—É—Ç—å).

---

## 11. –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
| ‚Ññ | –ü–µ—Ä–∏–æ–¥ | Milestone | –°—Ç–∞—Ç—É—Å |
|---|--------|-----------|--------|
| 1 | 24 –∏—é–Ω ‚Üí 30 –∏—é–Ω | –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Smart Tuner V2 (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, YAML) | ‚¨ú |
| 2 | 01 –∏—é–ª ‚Üí 07 –∏—é–ª | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è LogWatcher + MetricsStore | ‚¨ú |
| 3 | 08 –∏—é–ª ‚Üí 14 –∏—é–ª | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OptimizationEngine (Optuna) | ‚¨ú |
| 4 | 15 –∏—é–ª ‚Üí 21 –∏—é–ª | TrainerWrapper, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤ | ‚¨ú |
| 5 | 22 –∏—é–ª ‚Üí 28 –∏—é–ª | EarlyStopController + AlertManager | ‚¨ú |
| 6 | 29 –∏—é–ª ‚Üí 04 –∞–≤–≥ | CI, —Ç–µ—Å—Ç—ã, –¥–æ–∫–∏ | ‚¨ú |

–õ–µ–≥–µ–Ω–¥–∞: ‚¨ú ‚Äî –Ω–µ –Ω–∞—á–∞—Ç–æ, üü° ‚Äî –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, ‚úÖ ‚Äî –≥–æ—Ç–æ–≤–æ.

---

## 12. –ñ—É—Ä–Ω–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| 20-06-25 | 1.0.0 | –°–æ–∑–¥–∞–Ω –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π `TTS-Tech-Spec.md` —Å Smart Tuner V2. |

---

> –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã 11 –∏ 12, —á—Ç–æ–±—ã –æ—Ç—Ä–∞–∂–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å. 