# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º MLflow –≤ Smart Tuner TTS

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ Smart Tuner TTS —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç **–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫** –≤ MLflow –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è.

## üìà –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### üèãÔ∏è **Training Metrics (–∫–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è):**
- `training.loss` - –æ–±—â–∏–π loss –æ–±—É—á–µ–Ω–∏—è
- `training.taco_loss` - loss Tacotron2 –º–æ–¥–µ–ª–∏
- `training.atten_loss` - loss –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–Ω–∏–º–∞–Ω–∏—è
- `training.mi_loss` - MMI loss (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
- `training.guide_loss` - Guided Attention loss (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
- `training.gate_loss` - loss gate –≤—ã—Ö–æ–¥–æ–≤
- `training.emb_loss` - loss —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `grad.norm` - –Ω–æ—Ä–º–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
- `learning.rate` - —Ç–µ–∫—É—â–∏–π learning rate
- `duration` - –≤—Ä–µ–º—è –Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é
- `epoch` - —Ç–µ–∫—É—â–∞—è —ç–ø–æ—Ö–∞
- `iteration` - –Ω–æ–º–µ—Ä –∏—Ç–µ—Ä–∞—Ü–∏–∏

### üîç **Validation Metrics (–∫–∞–∂–¥—ã–µ N –∏—Ç–µ—Ä–∞—Ü–∏–π):**
- `validation.loss` - validation loss
- `validation.alignment_score` - –∫–∞—á–µ—Å—Ç–≤–æ alignment –º–∞—Ç—Ä–∏—Ü—ã
- `validation.attention_entropy` - —ç–Ω—Ç—Ä–æ–ø–∏—è attention
- `validation.attention_focus` - —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ attention
- `validation.gate_mean` - —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ gate –≤—ã—Ö–æ–¥–æ–≤
- `validation.gate_std` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ gate –≤—ã—Ö–æ–¥–æ–≤
- `validation.step` - —à–∞–≥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### ‚öôÔ∏è **Model Parameters (–æ–¥–∏–Ω —Ä–∞–∑):**
- `model.total_params` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏
- `model.trainable_params` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—É—á–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `hparams.batch_size` - —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
- `hparams.learning_rate` - learning rate
- `hparams.epochs` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö
- `hparams.grad_clip_thresh` - –ø–æ—Ä–æ–≥ –æ–±—Ä–µ–∑–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
- `hparams.fp16_run` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FP16
- `hparams.use_mmi` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MMI loss
- `hparams.use_guided_attn` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Guided Attention
- `dataset.train_size` - —Ä–∞–∑–º–µ—Ä training –¥–∞—Ç–∞—Å–µ—Ç–∞
- `dataset.val_size` - —Ä–∞–∑–º–µ—Ä validation –¥–∞—Ç–∞—Å–µ—Ç–∞

## üñ•Ô∏è **–ö–∞–∫ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**

### 1. **MLflow UI:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å MLflow UI (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω)
mlflow ui --host 0.0.0.0 --port 5000

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:5000
```

### 2. **–ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ MLflow UI:**
- **Experiments** ‚Üí **Default** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- **Runs** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤ –æ–±—É—á–µ–Ω–∏—è
- **Metrics** - –≥—Ä–∞—Ñ–∏–∫–∏ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
- **Parameters** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ –∏ –æ–±—É—á–µ–Ω–∏—è
- **Artifacts** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:**
- –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ runs –≤ —Å–ø–∏—Å–∫–µ
- –ù–∞–∂–º–∏—Ç–µ **Compare** –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Parallel Coordinates** –¥–ª—è –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## üìä **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**

### üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞:**
1. **`validation.loss`** - –≥–ª–∞–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
2. **`training.loss`** - –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è
3. **`validation.alignment_score`** - –∫–∞—á–µ—Å—Ç–≤–æ alignment
4. **`validation.attention_focus`** - —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ attention

### ‚ö†Ô∏è **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º:**
1. **`grad.norm`** - —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã (>10)
2. **`validation.gate_mean`** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–ª–∏–∑–∫–æ –∫ 0.5
3. **`training.guide_loss`** - –¥–æ–ª–∂–Ω–æ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è
4. **`duration`** - –≤—Ä–µ–º—è –Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**

### –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
# –í train.py –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ mlflow_metrics_enhancer
ENHANCED_LOGGING = True  # –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω enhanced logger
```

### –ß–∞—Å—Ç–æ—Ç–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
# –í hparams.py
validation_freq = 50  # –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 50 –∏—Ç–µ—Ä–∞—Ü–∏–π
```

## üìà **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫:**

### ‚úÖ **–•–æ—Ä–æ—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- `validation.loss` —Å—Ç–∞–±–∏–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
- `validation.alignment_score` > 0.5
- `validation.attention_focus` > 0.8
- `grad.norm` < 5.0
- `validation.gate_mean` ‚âà 0.5

### ‚ùå **–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- `validation.loss` —Ä–∞—Å—Ç–µ—Ç –∏–ª–∏ —Å—Ç–∞–≥–Ω–∏—Ä—É–µ—Ç
- `validation.alignment_score` < 0.3
- `grad.norm` > 10.0 (–≤–∑—Ä—ã–≤–∞—é—â–∏–µ—Å—è –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã)
- `validation.gate_mean` < 0.1 –∏–ª–∏ > 0.9

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
   - –î–µ—Ä–∂–∏—Ç–µ MLflow UI –æ—Ç–∫—Ä—ã—Ç—ã–º –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

2. **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
   - –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

3. **–†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:**
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ `grad.norm` –∏ `validation.loss`
   - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–∏ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
   - –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ `learning_rate`
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤–ª–∏—è–Ω–∏–µ `batch_size`

## üöÄ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ
python3 smart_tuner_main.py --mode train --trials 1

# 2. –û—Ç–∫—Ä—ã—Ç—å MLflow UI
mlflow ui --host 0.0.0.0 --port 5000

# 3. –ü–µ—Ä–µ–π—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:5000

# 4. –í—ã–±—Ä–∞—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ‚Üí Run ‚Üí Metrics
```

**üéâ –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ–±—É—á–µ–Ω–∏—è TTS –º–æ–¥–µ–ª–∏!** 